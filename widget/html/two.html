<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,minimum-scale=1, maximum-scale=1">
    <title>首页</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/commen.css">
    <link rel="stylesheet" href="../css/api.css">

</head>
<body>
<div class="container-fluid">
   <!--头部-->
    <div class="row clearfix index_header">
        <div class="col-md-2 col-sm-1 column">
        </div>
        <div class="col-md-8 col-sm-10 column">
            <div class="row clearfix index_header_one">
               
                <div class=" index_header_sign">
                    <a href="login.html" id="login">登录</a>
                    <a href="javascript:void(0)" onclick="fnloginout()" id="logout">退出</a>
                    <a href="background/list.html" id="logbg">[登录后台]</a>

                </div>
                 <div class=" index_header_link">
                    <a href="">媒体</a>
                    <a href="">严选</a>
                    <a href="">商旅</a>
                    <a href="">咨询</a>
                    <a href="">会展</a>
                    <a href="">教育</a>

                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-1 column">
        </div>
    </div>
    <!--logo-->
    <div class="row clearfix index_logo">
        <div class="col-md-2 col-sm-1 column">
        </div>
        <div class="col-md-8 col-sm-10 column">
            <div class="row clearfix ">
                <div class="col-md-8 col-sm-8 index_logo_img">
                    <img src="../image/logo.png">
                    <span>——<span>非洲最具影响力的平台</span></span>
                </div>
                <div class="col-md-4 col-sm-4 index_logo_call">
                    <p>电话：<span>0311-12345678</span></p>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-1 column">
        </div>
    </div>
    <!--导航-->
    <div class="row clearfix index_nav">
        <div class="col-md-2 col-sm-1 col-xs-1 column">
        </div>
        <div class="col-md-8 col-sm-10 col-xs-10 column index_nav_content">
            <div>
                <a href="one.html">首页</a>
                <a href="two.html"  class="index_nav_active">组合报价</a>
                <a href="four.html">热销报价</a>
            </div>
        </div>
        <div class="col-md-2 col-sm-1 col-xs-1 column">

        </div>
    </div>

    <!--频道报价菜单-->
    <div class="row clearfix index_advan">
        <div class="col-md-2 col-sm-1 column">
        </div>
        <div class="col-md-8 col-sm-10 column">
            <div class="row index_advan_title">
                <div class="col-md-12 column">
                    <p>频道报价菜单</p>
                </div>
            </div>

            <div class="row combination_content">
                <div class="col-md-12 column combination_tab" id="combination_tab">
                    <!-- <div class="combination_tab_active" id="value_1">媒体</div>
                    <div>严选</div>
                    <div>商旅</div>
                    <div>咨询</div>
                    <div>会展</div>
                    <div>教育</div> -->
                </div>
                <div class="col-md-12 column combination_tab_content">
                    <div class="combination_tab_content_show" >
                        <table class="two_table_one combination_a" id="combination_content_show">
                           <!--  <tr>
                                <th>id</th>
                                <th>所属频道</th>
                                <th>名称</th>
                                <th>卖点</th>
                                <th>服务权益</th>
                                <th>价格</th>
                                <th>操作</th>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>媒体</td>
                                <td>首页广告</td>
                                <td>垂直投放受众精准，网站核心版位的高附加值体现</td>
                                <td>一个图片类广告投放行业站点首页，链接至指定位置</td>
                                <td class="offer_money">4000元/月</td>
                                <td class="two_add">添加</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>媒体</td>
                                <td>首页广告</td>
                                <td>垂直投放受众精准，网站核心版位的高附加值体现</td>
                                <td>一个图片类广告投放行业站点首页，链接至指定位置</td>
                                <td class="offer_money">4000元/月</td>
                                <td class="two_add">添加</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>媒体</td>
                                <td>首页广告</td>
                                <td>垂直投放受众精准，网站核心版位的高附加值体现</td>
                                <td>一个图片类广告投放行业站点首页，链接至指定位置</td>
                                <td class="offer_money">4000元/月</td>
                                <td class="two_add">添加</td>
                            </tr> -->
                        </table>
                    </div>
                    <!-- <div class="">
                        <table class="two_table_one combination_a">

                            <tr>
                                <td>id</td>
                                <th>所属频道</th>
                                <th>名称</th>
                                <th>卖点</th>
                                <th>服务权益</th>
                                <th>价格</th>
                                <th>操作</th>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td>严选</td>
                                <td>首页广告</td>
                                <td>垂直投放受众精准，网站核心版位的高附加值体现</td>
                                <td>一个图片类广告投放行业站点首页，链接至指定位置</td>
                                <td class="offer_money">4000元/月</td>
                                <td class="two_add">添加</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td>严选</td>
                                <td>首页广告</td>
                                <td>垂直投放受众精准，网站核心版位的高附加值体现</td>
                                <td>一个图片类广告投放行业站点首页，链接至指定位置</td>
                                <td class="offer_money">4000元/月</td>
                                <td class="two_add">添加</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td>严选</td>
                                <td>首页广告</td>
                                <td>垂直投放受众精准，网站核心版位的高附加值体现</td>
                                <td>一个图片类广告投放行业站点首页，链接至指定位置</td>
                                <td class="offer_money">4000元/月</td>
                                <td class="two_add">添加</td>
                            </tr>


                        </table>
                    </div>
                    <div class="">
                        <table class="two_table_one combination_a">

                            <tr>
                                <td>id</td>
                                <th>所属频道</th>
                                <th>名称</th>
                                <th>卖点</th>
                                <th>服务权益</th>
                                <th>价格</th>
                                <th>操作</th>
                            </tr>
                            <tr>
                                <td>7</td>
                                <td>商旅</td>
                                <td>首页广告</td>
                                <td>垂直投放受众精准，网站核心版位的高附加值体现</td>
                                <td>一个图片类广告投放行业站点首页，链接至指定位置</td>
                                <td class="offer_money">4000元/月</td>
                                <td class="two_add">添加</td>
                            </tr>


                        </table>
                    </div>
                    <div class="">
                        <table class="two_table_one combination_a">

                            <tr>
                                <td>id</td>
                                <th>所属频道</th>
                                <th>名称</th>
                                <th>卖点</th>
                                <th>服务权益</th>
                                <th>价格</th>
                                <th>操作</th>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td>咨询</td>
                                <td>首页广告</td>
                                <td>垂直投放受众精准，网站核心版位的高附加值体现</td>
                                <td>一个图片类广告投放行业站点首页，链接至指定位置</td>
                                <td class="offer_money">4000元/月</td>
                                <td class="two_add">添加</td>
                            </tr>


                        </table>
                    </div>
                    <div class="">
                        <table class="two_table_one combination_a">

                            <tr>
                                <td>id</td>
                                <th>所属频道</th>
                                <th>名称</th>
                                <th>卖点</th>
                                <th>服务权益</th>
                                <th>价格</th>
                                <th>操作</th>
                            </tr>
                            <tr>
                                <td>11</td>
                                <td>会展</td>
                                <td>首页广告</td>
                                <td>垂直投放受众精准，网站核心版位的高附加值体现</td>
                                <td>一个图片类广告投放行业站点首页，链接至指定位置</td>
                                <td class="offer_money">4000元/月</td>
                                <td class="two_add">添加</td>
                            </tr>


                        </table>
                    </div>
                    <div class="">
                        <table class="two_table_one combination_a">

                            <tr>
                                <td>id</td>
                                <th>所属频道</th>
                                <th>名称</th>
                                <th>卖点</th>
                                <th>服务权益</th>
                                <th>价格</th>
                                <th>操作</th>
                            </tr>
                            <tr>
                                <td>12</td>
                                <td>教育</td>
                                <td>首页广告</td>
                                <td>垂直投放受众精准，网站核心版位的高附加值体现</td>
                                <td>一个图片类广告投放行业站点首页，链接至指定位置</td>
                                <td class="offer_money">4000元/月</td>
                                <td class="two_add">添加</td>
                            </tr>


                        </table>
                    </div>
 -->
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-1 column">
        </div>
    </div>

    <!--已选报价-->
    <div class="row clearfix index_advan">
        <div class="col-md-2 col-sm-1 column">
        </div>
        <div class="col-md-8 col-sm-10 column">
            <div class="row index_advan_title">
                <div class="col-md-12 column">
                    <p>已选报价</p>
                </div>
            </div>
            <div class="row combination_content">

                <div class="col-md-12 column combination_tab_content combination_have">
                    <div class="combination_tab_content_show">
                        <table class="two_table_two combination_a">
                            <tr>
                                <th></th>
                                <th>所属频道</th>
                                <th>名称</th>
                                <th>卖点</th>
                                <th>服务权益</th>
                                <th>价格</th>
                                <th>操作</th>
                            </tr>



                        </table>
                    </div>


                </div>
            </div>
            <div class="row combination_finished">
                <div class="col-md-12 combination_finished_info">
                    <div>
                        <div>报价单名称：</div>
                        <div>
                            <label for="good_1"></label>
                            <input type="text" id="good_1" value="0">
                        </div>
                    </div>
                    <div>
                        <div>套餐说明：</div>
                        <div>
                            <form>
                                <textarea rows="3" ></textarea>
                                <input type="text" value="0" id="good_2" >
                            </form>
                           </div>
                    </div>
                    <div class="combination_finished_info_btn">生成报价套餐</div>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-1 column">
        </div>
    </div>


</div>

  <div class="two_white">
      <p>您还没有选择报价！</p>
      <div>确定</div>
  </div>
<script src="../script/jquery-3.1.1.min.js"></script>
<script src="../script/bootstrap.min.js"></script>
<script src="../script/api.js"></script>
<script src="../script/sha1.js"></script>
<script src="../script/commen.js"></script>

<script>
apiready = function() {
    // 获取登录信息
    var userId=$api.getStorage('userId');     
    if(userId != undefined){
        // 已经登录        
        $api.byId("logout").style.display="inline-block"; 
        $api.byId("logbg").style.display="inline-block";       
        $api.byId("login").setAttribute("href","javascript:void(0)");
        loginInfo();
    }
    else{
        $api.byId("logout").style.display="none";
        $api.byId("logbg").style.display="none";
        $api.byId("login").setAttribute("href","login.html");        
    }   
    fnGetquotationList();
};
// 获取用户名
function loginInfo(){    
    var userId=$api.getStorage('userId'); 
    var now = Date.now(); 
    var appKey = SHA1("A6075527744015"+"UZ"+ "89BAEF2B-99AE-1AA6-31DD-601F72673D41"+"UZ"+now)+"."+now;    
    api.ajax({
        url: 'https://d.apicloud.com/mcm/api/user/' + userId,
        method: 'get',
        headers: {
            "X-APICloud-AppId": "A6075527744015",
            "X-APICloud-AppKey": appKey
        }
    }, function(ret, err) {
        if (ret) {           
            //alert(JSON.stringify(ret));
            $api.byId("login").innerText=ret.username;     
        } else {
            alert(JSON.stringify(err));
        }
    });
}

// 退出
function fnloginout(){
    var uId=$api.getStorage('uId'); 
    //alert(uId);
    var now = Date.now(); 
    var appKey = SHA1("A6075527744015"+"UZ"+ "89BAEF2B-99AE-1AA6-31DD-601F72673D41"+"UZ"+now)+"."+now;    
    api.ajax({
        url: 'https://d.apicloud.com/mcm/api/user/logout',
        method: 'post',
        headers: {
            "X-APICloud-AppId": "A6075527744015",
            "X-APICloud-AppKey": appKey,
            "authorization":uId
        }
    }, function(ret, err) {
        if (ret) {           
            //alert(JSON.stringify(ret));
            $api.byId("login").innerText='登录';
            $api.byId("login").setAttribute("href","login.html");
            $api.byId("logout").style.display="none";  
             $api.byId("logbg").style.display="none";
                 
        } else {
            alert(JSON.stringify(err));
        }
    });
}


// 获取频道分类列表
function fnGetquotationList() {
    var now = Date.now(); 
      var appKey = SHA1("A6075527744015"+"UZ"+ "89BAEF2B-99AE-1AA6-31DD-601F72673D41"+"UZ"+now)+"."+now; 

// 获取分类
    var params_one = {
        fields: {
            createdAt: false,
            updatedAt: false
        },
        where: {},
        skip: 0,
        // limit: 
    }
    params_one = $api.jsonToStr(params_one);
    api.ajax({
        url: 'https://d.apicloud.com/mcm/api/channel?filter=' + params_one,
        method: 'get',
        headers: {
            "X-APICloud-AppId": "A6075527744015",
            "X-APICloud-AppKey": appKey
        }
    }, function(ret, err) {
        if (ret) {
            // 显示分类
            //alert(ret);
             fnchannelList(ret);
        } else {
            alert(JSON.stringify(err));
        }
    });

    //获取商品列表
     var params_two = {
        fields: {
            createdAt: false,
            updatedAt: false
        },
        where: {
            channelname:'媒体' 
        },
        skip: 0,
        // limit: 
    }
    params_two = $api.jsonToStr(params_two);
    api.ajax({
        url: 'https://d.apicloud.com/mcm/api/quotation?filter=' + params_two,
        method: 'get',
        headers: {
            "X-APICloud-AppId": "A6075527744015",
            "X-APICloud-AppKey": appKey
        }
    }, function(ret, err) {
        if (ret) {
            alert(JSON.stringify(ret));

             fnquotationList(ret);
        } else {
            alert(JSON.stringify(err));
        }
    });

    
}
// 显示分类
function fnchannelList(data_) {    
    var list = $api.byId('combination_tab');
    var html = '';    
     for (var i = 0; i < data_.length; i++) {    
         
         if (data_[i].channelname) {  
            if(i == 0){
               
               html += '<div class="combination_tab_active">'+data_[i].channelname+'</div>';
            
            }   
            if(i != 0){
                
                html += '<div>'+data_[i].channelname+'</div>';
            }     
             
         }
     }

    $api.html(list, html);
}

// 显示分类频道
function fnquotationList(data){
    alert(data.length);
    var combination_content_show=$api.byId('combination_content_show');
    var head='<tr><th>id</th><th>所属频道</th><th>名称</th><th>卖点</th><th>服务权益</th><th>价格</th><th>操作</th></tr>';
    combination_content_show += head;
    var html='';
      for (var i = 0; i < data.length; i++) {   
         
         if (data[i].name) {  
              html += '<tr><td>'+data[i].id+'</td><td>'+data[i].channelname+'</td><td>'+data[i].quoname+'</td><td>'+data[i].selling_point+'</td><td>'+data[i].content+'</td><td class="offer_money">'+data[i].price+data[i].monetary_unit+'</td><td class="two_add">添加</td></tr>'
             
         }
     }
     combination_content_show += html;
     
    $api.html(combination_content_show, combination_content_show);

}

</script>
</body>
</html>